<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    
    <link
      rel="stylesheet"
      href="lib/leaflet.css"
    />
    <link
      rel="icon"
      href="images/logo.png"
    />
  
    <link
      rel="stylesheet"
      href="image/logo.png"
    />
    
    <link
      rel="stylesheet"
      href="lib/geosearch.css"
    />

	<link
      rel="stylesheet"
      href="lib/leaflet.draw.css"
    />

    <title>Геопортал города Тюмени</title>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      html, body, #map {
        height: 100%;
        width: 100%;
      
      }
      .leaflet-control-scale {
        font-size: 12px;
      }
      .leaflet-control-scale .leaflet-control-scale-line:last-child {
        display: none;
      }

      .leaflet-control-coordinates {
        border-radius: 7px;
        padding: 5px 10px;
        font-size: 13px;
        height: 10px;
        text-align: center;
        line-height: 12px;
        background-color: rgba(255, 255, 255, 1);
        bottom: -5px;
        box-shadow: 0 0 9px #0846cd;
      }

      .leaflet-control-layers-toggle {
        /*background-size: contain;*/
        background-repeat: no-repeat;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .leaflet-control-layers {
      /*width: 20px;*/
      /*height: 20px;*/
      /*border: 2px solid #ccc;*/
        border-radius: 8px;
        line-height: 12px;
        background-color: rgba(255, 255, 255, 1);
      }

      .leaflet-control-geosearch {
		position: relative;
		bottom: 1px;
	  }
	  
	 
	 
	  
    </style>
  </head>
  <body>
    <div id="map"></div>
<script src="lib/leaflet-src.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://raw.githubusercontent.com/calvinmetcalf/leaflet-ajax/master/dist/leaflet.ajax.min.js"></script>
<script src="lib/Leaflet.Coordinates-0.1.5.src.js"></script>
<script src="lib/geosearch.umd.js"></script>
<script src="lib/src/Leaflet.draw.js"></script>
<script src="lib/src/Leaflet.Draw.Event.js"></script>
<script src="lib/src/Toolbar.js"></script>
<script src="lib/src/Tooltip.js"></script>
<script src="lib/ext/LatLngUtil.js"></script>
<script src="lib/ext/LineUtil.Intersect.js"></script>
<script src="lib/ext/Polygon.Intersect.js"></script>
<script src="lib/ext/Polyline.Intersect.js"></script>
<script src="lib/ext/TouchEvents.js"></script>
<script src="lib/draw/DrawToolbar.js"></script>
<script src="lib/draw/handler/Draw.Feature.js"></script>
<script src="lib/draw/handler/Draw.SimpleShape.js"></script>
<script src="lib/draw/handler/Draw.Polyline.js"></script>
<script src="lib/draw/handler/Draw.Marker.js"></script>
<script src="lib/draw/handler/Draw.CircleMarker.js"></script>
<script src="lib/draw/handler/Draw.Circle.js"></script>
<script src="lib/draw/handler/Draw.Polygon.js"></script>
<script src="lib/draw/handler/Draw.Rectangle.js"></script>
<script src="lib/edit/EditToolbar.js"></script>
<script src="lib/edit/handler/EditToolbar.Edit.js"></script>
<script src="lib/edit/handler/EditToolbar.Delete.js"></script>
<script src="lib/src/Control.Draw.js"></script>
<script src="lib/edit/handler/Edit.Poly.js"></script>
<script src="lib/edit/handler/Edit.SimpleShape.js"></script>
<script src="lib/edit/handler/Edit.Marker.js"></script>
<script src="lib/edit/handler/Edit.CircleMarker.js"></script>
<script src="lib/edit/handler/Edit.Circle.js"></script>
<script src="lib/edit/handler/Edit.Rectangle.js"></script>
<script>
  var map = L.map('map', {
    attributionControl: false,
    zoomControl: false,
    minZoom: 11,
    maxBounds:[ 
      [56.96839, 65.23384], 
      [57.32589, 65.92023] 
    ],
  }).setView([57.1679, 65.4662], 11);

  var osmLayer = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  }).addTo(map);
  
  const provider = new GeoSearch.OpenStreetMapProvider({
    params: {
    bounded: 1,
    countrycodes: 'ru',
    viewbox: [
      65.2338,
      56.9684,
      65.9202,
      57.3259
    ].join(',')
    }
  });
  
  const search = new GeoSearch.GeoSearchControl({
    provider: provider,
    style: 'button',
    autoComplete: true,
    autoCompleteDelay: 1200,
    searchLabel: 'Введите адрес',
    notFoundMessage: 'Ничего не найдено',
    showMarker: true,
    showPopup: true,
    marker: {
      icon: new L.Icon.Default(),
      draggable: false,
    },
    popupFormat: ({ query, result }) => result.label,
    resultFormat: ({ result }) => result.label,
    keepResult: true,
  });
  
  map.addControl(search);
    
  var baseLayers = {
        "ЕЭКО": L.tileLayer("https://ngw.fppd.cgkipd.ru/tile/56/{z}/{x}/{y}.png", {
        }),
        "2ГИС": L.tileLayer("https://tile3.maps.2gis.com/tiles?x={x}&y={y}&z={z}&v=1.1", {
        }),        
        "OSM": L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        }),
        "Google": L.tileLayer("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}", {
        }),
        "Mapbox": L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaG9uZXlmaW5nZXIiLCJhIjoiY2xoZmRnMGY4MTVlYTNzbnY2YTYydmFpZiJ9.hLzJmqq2UXv9czh28X0e-w", {
        }),
        "ПКК": L.tileLayer("https://gext.ru/rosreestr_xyz/{z}/{x}/{y}.png", {
        }),
  };

      L.control.layers(baseLayers).addTo(map);

      L.control.coordinates({
        position: "bottomright",
        labelTemplateLat: "Широта: {y}",
        labelTemplateLng: "Долгота: {x}",
        useDMS: true,
        useLatLngOrder: true,
      }).addTo(map);

      L.control.zoom({
			  position: 'topright'
      }).addTo(map);

      L.control.scale().addTo(map);

      fetch("https://raw.githubusercontent.com/tmn72/geoportal/main/geojson/fon.geojson")
        .then(function(resp) {
          resp.json().then(function(geojson) {
            L.geoJSON(geojson, {
              style: function(feature) {
                return {
                  fillColor: "#fafafa",
                  fillOpacity: 1,
                  weight: 0
                };
              },
            onEachFeature: function(feature, layer) {
              const name = feature.properties.NAME;
              if (name) {
                layer.bindTooltip(feature.properties.NAME, {
                  permanent: true
                });
              }
            },
          }).addTo(map);
        });
      });

const waterwaysLayer = L.geoJSON();

const waterALayer = L.geoJSON();

fetch("https://raw.githubusercontent.com/tmn72/geoportal/main/geojson/waterways.geojson")
  .then(response => response.json())
  .then(data => {
    waterwaysLayer.addData(data);
    waterwaysLayer.eachLayer(function(layer) {
      layer.on('click', function(e) {
        map.flyToBounds(this.getBounds(), {padding: [50, 50]});
      });
    });
  })
  .catch(error => console.log(error));

fetch("https://raw.githubusercontent.com/tmn72/geoportal/main/geojson/water_a.geojson")
  .then(response => response.json())
  .then(data => {
    waterALayer.addData(data);
    waterALayer.eachLayer(function(layer) {
      layer.on('click', function(e) {
        map.flyToBounds(this.getBounds(), {padding: [50, 50]});
      });
    });
  })
  .catch(error => console.log(error));

const waterwaysGroup = L.layerGroup([waterwaysLayer]);
const waterAGroup = L.layerGroup([waterALayer]);

const controlLayers2 = L.control.layers(null, {
  "Гидрография (линии)": waterwaysGroup,
  "Гидрография (полигоны)": waterAGroup
});

controlLayers2.addTo(map);


const toggle1 = L.control.layers.toggle(undefined, undefined, {
  collapsed: false,
  exclusiveGroups: ["ЕЭКО", "2ГИС", "OSM", "Google", "Mapbox", "ПКК"],
  className: "my-custom-class-1 my-layers-toggle",
  containerWidth: "auto",
  containerHeight: "auto"
}).addTo(map);

const toggle2 = L.control.layers.toggle(undefined, undefined, {
  collapsed: false,
  exclusiveGroups: ["Гидрография (линии)", "Гидрография (полигоны)"],
  className: "my-custom-class-2 my-layers-toggle",
  containerWidth: "auto",
  containerHeight: "auto"
}).addTo(map);

</script>
</body>
</html>